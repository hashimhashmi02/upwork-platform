generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String   @id @default(uuid())
  name       String
  email      String   @unique
  password   String
  role       String   @default("client")
  bio        String?
  skills     Json     @default("[]")
  hourlyRate Float?   @map("hourly_rate")
  createdAt  DateTime @default(now()) @map("created_at")

  services              Service[]
  projects              Project[]
  proposalsSent         Proposal[]
  contractsAsClient     Contract[] @relation("ClientContracts")
  contractsAsFreelancer Contract[] @relation("FreelancerContracts")
  reviewsGiven          Review[]   @relation("ReviewerReviews")
  reviewsReceived       Review[]   @relation("RevieweeReviews")

  @@map("users")
}

model Service {
  id           String   @id @default(uuid())
  freelancerId String   @map("freelancer_id")
  title        String
  description  String
  category     String
  pricingType  String   @map("pricing_type")
  price        Float
  deliveryDays Int      @map("delivery_days")
  rating       Float    @default(0)
  totalReviews Int      @default(0) @map("total_reviews")
  createdAt    DateTime @default(now()) @map("created_at")

  freelancer User @relation(fields: [freelancerId], references: [id])

  @@map("services")
}

model Project {
  id             String   @id @default(uuid())
  clientId       String   @map("client_id")
  title          String
  description    String
  category       String
  budgetMin      Float    @map("budget_min")
  budgetMax      Float    @map("budget_max")
  deadline       DateTime
  status         String   @default("open")
  requiredSkills Json     @default("[]") @map("required_skills")
  createdAt      DateTime @default(now()) @map("created_at")

  client    User       @relation(fields: [clientId], references: [id])
  proposals Proposal[]
  contracts Contract[]

  @@map("projects")
}

model Proposal {
  id                String   @id @default(uuid())
  projectId         String   @map("project_id")
  freelancerId      String   @map("freelancer_id")
  coverLetter       String   @map("cover_letter")
  proposedPrice     Float    @map("proposed_price")
  estimatedDuration Int      @map("estimated_duration")
  status            String   @default("pending")
  createdAt         DateTime @default(now()) @map("created_at")

  project    Project @relation(fields: [projectId], references: [id])
  freelancer User    @relation(fields: [freelancerId], references: [id])

  @@unique([projectId, freelancerId])
  @@map("proposals")
}

model Contract {
  id           String   @id @default(uuid())
  projectId    String   @map("project_id")
  freelancerId String   @map("freelancer_id")
  clientId     String   @map("client_id")
  totalAmount  Float    @map("total_amount")
  status       String   @default("active")
  createdAt    DateTime @default(now()) @map("created_at")

  project    Project     @relation(fields: [projectId], references: [id])
  freelancer User        @relation("FreelancerContracts", fields: [freelancerId], references: [id])
  client     User        @relation("ClientContracts", fields: [clientId], references: [id])
  milestones Milestone[]
  reviews    Review[]

  @@map("contracts")
}

model Milestone {
  id          String   @id @default(uuid())
  contractId  String   @map("contract_id")
  title       String
  description String?
  amount      Float
  dueDate     DateTime @map("due_date")
  orderIndex  Int      @map("order_index")
  status      String   @default("pending")
  createdAt   DateTime @default(now()) @map("created_at")

  contract Contract @relation(fields: [contractId], references: [id])

  @@map("milestones")
}

model Review {
  id         String   @id @default(uuid())
  contractId String   @map("contract_id")
  reviewerId String   @map("reviewer_id")
  revieweeId String   @map("reviewee_id")
  rating     Int
  comment    String?
  createdAt  DateTime @default(now()) @map("created_at")

  contract Contract @relation(fields: [contractId], references: [id])
  reviewer User     @relation("ReviewerReviews", fields: [reviewerId], references: [id])
  reviewee User     @relation("RevieweeReviews", fields: [revieweeId], references: [id])

  @@unique([contractId, reviewerId])
  @@map("reviews")
}
